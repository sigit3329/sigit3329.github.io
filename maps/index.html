<!DOCTYPE html>
<html lang="id" data-theme="dark">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Peta Lokasi</title>

  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" crossorigin="">
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" crossorigin="" defer></script>

  <style>
    /* ========== THEME VARS ========== */
    :root{
      --bg:#0b1220; --panel:#0f172a; --text:#e5e7eb; --muted:#9aa3b2;
      --primary:#0ea5e9; --ring:rgba(14,165,233,.45); --bd:rgba(148,163,184,.2);
    }
    :root[data-theme="light"]{
      --bg:#f8fafc; --panel:#ffffff; --text:#0f172a; --muted:#475569;
      --primary:#0ea5e9; --ring:rgba(14,165,233,.35); --bd:rgba(15,23,42,.15);
    }

    html,body{height:100%;margin:0;background:var(--bg);color:var(--text)}
    .page{min-height:100%;display:flex;flex-direction:column}
    header{padding:12px 16px}
    header h1{margin:0 0 4px;font-size:18px}
    header p{margin:0;color:var(--muted);font-size:13px}
    #map{flex:1 1 auto}
    .toolbar{display:flex;flex-wrap:wrap;gap:8px;padding:12px 16px 16px;background:linear-gradient(180deg,rgba(255,255,255,.03),transparent 60%)}
    .btn{appearance:none;border:1px solid var(--bd);color:var(--text);background:var(--panel);padding:10px 14px;border-radius:12px;font-weight:600;text-decoration:none;display:inline-flex;align-items:center;gap:8px}
    .btn.primary{background:var(--primary);border-color:transparent;color:#fff}
    .btn:focus-visible{outline:2px solid var(--ring);outline-offset:2px}
    .leaflet-container{background:#0f172a}
    :root[data-theme="light"] .leaflet-container{background:#eef2ff}
    .leaflet-control-attribution{color:#cbd5e1}
    :root[data-theme="light"] .leaflet-control-attribution{color:#64748b}
    .leaflet-control-attribution a{color:#93c5fd}
    :root[data-theme="light"] .leaflet-control-attribution a{color:#2563eb}
    .leaflet-popup-content-wrapper,.leaflet-popup-tip{background:var(--panel);color:var(--text)}
  </style>
</head>
<body>
  <div class="page">
    <header>
      <!-- <h1>Lokasi</h1> -->
      <p id="info">Workshop Sigit Berkarya • Banguntapan, Bantul, DI Yogyakarta • -7.755604, 110.411669</p>
    </header>

    <div id="map" aria-label="Peta lokasi"></div>

    <div class="toolbar">
      <a id="toGmaps" class="btn primary" target="_blank" rel="noopener">Arahkan via Google Maps</a>
      <a id="toWaze"  class="btn" target="_blank" rel="noopener">Arahkan via Waze</a>
      <button id="useMyLoc" class="btn" type="button">Gunakan lokasiku</button>
      <button id="copyCoord" class="btn" type="button">Salin koordinat</button>
      <div class="card-actions">
          <a class="btn" href="index.html" target="_blank" rel="noopener">Buka peta penuh</a>
        </div>
    </div>
  </div>

  <script>
    // === Data Lokasi (ubah kalau perlu) ===
    const DEST = { lat: -7.755604, lng: 110.411669 };
    const LOCATION_NAME = "Workshop Si-GIT";
    const LOCATION_ADDRESS = "Banguntapan, Bantul, DI Yogyakarta";
    const ZOOM = 15;

    // Tile URL
    const LIGHT_URL = 'https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png';
    const DARK_URL  = 'https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png';

    // Baca tema awal via query (?theme=light|dark|system) atau media query
    function initialTheme(){
      const p = new URLSearchParams(location.search);
      const q = p.get('theme');
      if (q === 'light' || q === 'dark') return q;
      const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
      return prefersDark ? 'dark' : 'light';
    }

    let THEME = initialTheme();
    document.documentElement.setAttribute('data-theme', THEME);

    window.addEventListener('load', () => {
      const map = L.map('map', { scrollWheelZoom:true }).setView([DEST.lat, DEST.lng], ZOOM);

      let base = L.tileLayer(THEME === 'dark' ? DARK_URL : LIGHT_URL, {
        maxZoom: 20,
        attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OSM</a>' + (THEME==='dark'?' & Carto':'')
      }).addTo(map);

      L.marker([DEST.lat, DEST.lng]).addTo(map).bindPopup(`
        <b>${LOCATION_NAME}</b><br>
        ${LOCATION_ADDRESS}<br>
        ${DEST.lat.toFixed(6)}, ${DEST.lng.toFixed(6)}<br>
        <a href="https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(LOCATION_NAME)}%20${DEST.lat}%2C${DEST.lng}" target="_blank" rel="noopener">Buka di Google Maps</a>
      `);

      // Tautan navigasi
      document.getElementById('toGmaps').href = `https://www.google.com/maps/dir/?api=1&destination=${DEST.lat},${DEST.lng}`;
      document.getElementById('toWaze').href  = `https://waze.com/ul?ll=${DEST.lat}%2C${DEST.lng}&navigate=yes`;

      // Lokasi saya → origin
      document.getElementById('useMyLoc').addEventListener('click', () => {
        if (!navigator.geolocation) return alert('Geolokasi tidak didukung browser ini.');
        navigator.geolocation.getCurrentPosition(
          pos => {
            const oLat = pos.coords.latitude.toFixed(6);
            const oLng = pos.coords.longitude.toFixed(6);
            window.open(`https://www.google.com/maps/dir/?api=1&origin=${oLat},${oLng}&destination=${DEST.lat},${DEST.lng}`, '_blank', 'noopener');
          },
          err => alert('Gagal mengambil lokasi: ' + (err?.message || 'unknown')),
          { enableHighAccuracy:true, timeout:10000 }
        );
      });

      // Salin koordinat
      document.getElementById('copyCoord').addEventListener('click', async () => {
        try { await navigator.clipboard.writeText(`${DEST.lat}, ${DEST.lng}`); alert('Koordinat disalin!'); }
        catch { alert('Gagal menyalin koordinat.'); }
      });

      // Terima sinyal tema dari parent (tanpa reload)
      window.addEventListener('message', (ev) => {
        if (!ev.data || ev.data.type !== 'theme') return;
        const next = ev.data.value === 'dark' ? 'dark' : 'light';
        if (next === THEME) return;
        THEME = next;
        document.documentElement.setAttribute('data-theme', THEME);
        map.removeLayer(base);
        base = L.tileLayer(THEME === 'dark' ? DARK_URL : LIGHT_URL, {
          maxZoom: 20,
          attribution: '&copy; OSM' + (THEME==='dark'?' & Carto':'')
        }).addTo(map);
      });
    });
  </script>
</body>
</html>
